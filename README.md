# üè¶ Bank Management System - API REST

[![Java](https://img.shields.io/badge/Java-17-red.svg)](https://www.oracle.com/java/)
[![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.2.0-brightgreen.svg)](https://spring.io/projects/spring-boot)
[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-16-blue.svg)](https://www.postgresql.org/)
[![Docker](https://img.shields.io/badge/Docker-Ready-2496ED.svg)](https://www.docker.com/)
[![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)

Une API REST compl√®te pour la gestion d'un syst√®me bancaire moderne avec authentification JWT, gestion des comptes et des transactions.

## üìã Table des mati√®res

- [Fonctionnalit√©s](#-fonctionnalit√©s)
- [Technologies utilis√©es](#Ô∏è-technologies-utilis√©es)
- [Pr√©requis](#-pr√©requis)
- [Installation](#-installation)
- [Configuration](#Ô∏è-configuration)
- [Lancement de l'application](#-lancement-de-lapplication)
- [Documentation API](#-documentation-api)
- [Endpoints](#-endpoints)
- [Exemples d'utilisation](#-exemples-dutilisation)
- [Tests](#-tests)
- [Structure du projet](#-structure-du-projet)
- [Docker](#-docker)
- [CI/CD](#-cicd)
- [Contribuer](#-contribuer)
- [Licence](#-licence)

## ‚ú® Fonctionnalit√©s

### üîê Authentification et S√©curit√©
- ‚úÖ Enregistrement d'utilisateurs avec validation
- ‚úÖ Connexion avec JWT (JSON Web Tokens)
- ‚úÖ Rafra√Æchissement automatique des tokens
- ‚úÖ Protection des routes avec Spring Security
- ‚úÖ Gestion des r√¥les et permissions (USER, ADMIN, MANAGER)
- ‚úÖ Hachage s√©curis√© des mots de passe avec BCrypt

### üí≥ Gestion des Comptes Bancaires
- ‚úÖ Cr√©ation de comptes (Courant, √âpargne, Professionnel, √âtudiant)
- ‚úÖ Consultation des d√©tails d'un compte
- ‚úÖ Liste de tous les comptes d'un utilisateur
- ‚úÖ Calcul du solde total
- ‚úÖ Activation/D√©sactivation/Suspension de comptes
- ‚úÖ G√©n√©ration automatique de num√©ros de compte uniques

### üí∏ Transactions Bancaires
- ‚úÖ **D√©p√¥ts** : Ajout d'argent sur un compte
- ‚úÖ **Retraits** : Retrait d'argent avec v√©rification du solde
- ‚úÖ **Virements** : Transfert entre comptes avec validation
- ‚úÖ Historique complet des transactions
- ‚úÖ Filtrage par date, type et statut
- ‚úÖ Pagination et tri des r√©sultats
- ‚úÖ Num√©ros de r√©f√©rence uniques pour chaque transaction
- ‚úÖ Statistiques d√©taill√©es des transactions

### üìä Fonctionnalit√©s Avanc√©es
- ‚úÖ Validation compl√®te des donn√©es avec Bean Validation
- ‚úÖ Gestion centralis√©e des exceptions
- ‚úÖ Logs d√©taill√©s pour le debugging
- ‚úÖ Documentation Swagger/OpenAPI interactive
- ‚úÖ Support multi-devises
- ‚úÖ Transactions ACID avec isolation
- ‚úÖ Audit automatique (createdAt, updatedAt)

## üõ†Ô∏è Technologies utilis√©es

### Backend
- **Java 17** - Langage de programmation
- **Spring Boot 3.2.0** - Framework principal
- **Spring Security** - Authentification et autorisation
- **Spring Data JPA** - Persistance des donn√©es
- **Hibernate** - ORM
- **PostgreSQL 16** - Base de donn√©es relationnelle

### S√©curit√©
- **JWT (JSON Web Tokens)** - Authentification stateless
- **BCrypt** - Hachage des mots de passe
- **JJWT 0.12.3** - Gestion des tokens JWT

### Documentation
- **Springdoc OpenAPI 3** - Documentation API
- **Swagger UI** - Interface interactive de test

### Outils & DevOps
- **Maven** - Gestion des d√©pendances
- **Docker** - Conteneurisation
- **Docker Compose** - Orchestration des services
- **Lombok** - R√©duction du code boilerplate
- **SLF4J & Logback** - Logging

## üì¶ Pr√©requis

Avant de commencer, assurez-vous d'avoir install√© :

- **Java JDK 17** ou sup√©rieur
- **Maven 3.6+**
- **PostgreSQL 12+** (ou utilisez Docker)
- **Docker** et **Docker Compose** (optionnel mais recommand√©)
- **Git**

### V√©rifier les installations

```bash
java -version    # Devrait afficher Java 17+
mvn -version     # Devrait afficher Maven 3.6+
docker --version # Devrait afficher Docker 20+
psql --version   # Devrait afficher PostgreSQL 12+
```

## üöÄ Installation

### 1. Cloner le projet

```bash
git clone https://github.com/votre-username/bank-system.git
cd bank-system
```

### 2. Configurer la base de donn√©es PostgreSQL

#### Option A : Installation locale

```bash
# Cr√©er la base de donn√©es
psql -U postgres

CREATE DATABASE bankdb;
CREATE USER bankuser WITH PASSWORD 'bankpass';
GRANT ALL PRIVILEGES ON DATABASE bankdb TO bankuser;
\q
```

#### Option B : Utiliser Docker (recommand√©)

```bash
docker run --name bank-postgres \
  -e POSTGRES_DB=bankdb \
  -e POSTGRES_USER=bankuser \
  -e POSTGRES_PASSWORD=bankpass \
  -p 5432:5432 \
  -d postgres:16-alpine
```

### 3. Configurer les variables d'environnement

Cr√©ez un fichier `.env` √† la racine du projet (optionnel) :

```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=bankdb
DB_USERNAME=bankuser
DB_PASSWORD=bankpass
JWT_SECRET=404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970
SERVER_PORT=8080
```

### 4. Compiler le projet

```bash
mvn clean install
```

## ‚öôÔ∏è Configuration

Les configurations se trouvent dans `src/main/resources/application.yml`.

### Configurations importantes

```yaml
# Base de donn√©es
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/bankdb
    username: bankuser
    password: bankpass

# JWT
jwt:
  secret: votre-secret-key-base64
  expiration: 86400000  # 24 heures
  refresh-expiration: 604800000  # 7 jours

# Serveur
server:
  port: 8080
```

## üéØ Lancement de l'application

### M√©thode 1 : Avec Maven

```bash
mvn spring-boot:run
```

### M√©thode 2 : Avec le JAR compil√©

```bash
mvn clean package -DskipTests
java -jar target/bank-system-1.0.0.jar
```

### M√©thode 3 : Avec Docker Compose (recommand√©)

```bash
# Lancer tous les services (PostgreSQL + Application)
docker-compose up -d

# Voir les logs
docker-compose logs -f bank-app

# Arr√™ter les services
docker-compose down

# Arr√™ter et supprimer les volumes
docker-compose down -v
```

### M√©thode 4 : Avec pgAdmin (pour administration)

```bash
# Lancer avec pgAdmin
docker-compose --profile admin up -d

# Acc√©der √† pgAdmin : http://localhost:5050
# Email: admin@banksystem.com
# Mot de passe: admin123
```

L'application sera accessible sur : **http://localhost:8080**

## üìö Documentation API

Une fois l'application lanc√©e, acc√©dez √† la documentation Swagger :

- **Swagger UI (Interface interactive)** : http://localhost:8080/swagger-ui.html
- **OpenAPI JSON** : http://localhost:8080/api-docs
- **OpenAPI YAML** : http://localhost:8080/api-docs.yaml

### Utiliser Swagger UI

1. Ouvrez http://localhost:8080/swagger-ui.html
2. Cr√©ez un compte via `POST /api/auth/register`
3. Connectez-vous via `POST /api/auth/login`
4. Copiez le token JWT re√ßu
5. Cliquez sur le bouton **"Authorize"** en haut √† droite
6. Entrez : `Bearer {votre-token}`
7. Testez tous les endpoints prot√©g√©s !

## üîå Endpoints

### üîê Authentification (`/api/auth`)

| M√©thode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/auth/register` | Cr√©er un compte utilisateur | Non |
| POST | `/api/auth/login` | Se connecter | Non |
| POST | `/api/auth/refresh` | Rafra√Æchir le token | Non |
| POST | `/api/auth/logout` | Se d√©connecter | Oui |
| GET | `/api/auth/me` | Obtenir l'utilisateur actuel | Oui |
| GET | `/api/auth/status` | V√©rifier le statut d'authentification | Non |

### üí≥ Comptes (`/api/accounts`)

| M√©thode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/accounts` | Cr√©er un nouveau compte | Oui |
| GET | `/api/accounts` | Lister tous ses comptes | Oui |
| GET | `/api/accounts/{id}` | Obtenir un compte par ID | Oui |
| GET | `/api/accounts/number/{accountNumber}` | Obtenir un compte par num√©ro | Oui |
| GET | `/api/accounts/active` | Lister les comptes actifs | Oui |
| GET | `/api/accounts/balance/total` | Obtenir le solde total | Oui |
| GET | `/api/accounts/statistics` | Obtenir les statistiques | Oui |
| PATCH | `/api/accounts/{id}/deactivate` | D√©sactiver un compte | Oui |
| PATCH | `/api/accounts/{id}/suspend` | Suspendre un compte | Oui |
| PATCH | `/api/accounts/{id}/reactivate` | R√©activer un compte | Oui |

### üí∏ Transactions (`/api/transactions`)

| M√©thode | Endpoint | Description | Auth |
|---------|----------|-------------|------|
| POST | `/api/transactions/accounts/{id}/deposit` | Effectuer un d√©p√¥t | Oui |
| POST | `/api/transactions/accounts/{id}/withdraw` | Effectuer un retrait | Oui |
| POST | `/api/transactions/accounts/{id}/transfer` | Effectuer un virement | Oui |
| GET | `/api/transactions/history` | Historique de l'utilisateur | Oui |
| GET | `/api/transactions/history/paginated` | Historique pagin√© | Oui |
| GET | `/api/transactions/accounts/{id}/history` | Historique d'un compte | Oui |
| GET | `/api/transactions/accounts/{id}/history/paginated` | Historique pagin√© d'un compte | Oui |
| GET | `/api/transactions/accounts/{id}/history/period` | Transactions par p√©riode | Oui |
| GET | `/api/transactions/accounts/{id}/history/type/{type}` | Transactions par type | Oui |
| GET | `/api/transactions/accounts/{id}/statistics` | Statistiques des transactions | Oui |
| GET | `/api/transactions/reference/{referenceNumber}` | Obtenir une transaction par r√©f√©rence | Oui |

## üí° Exemples d'utilisation

### 1. S'enregistrer

```bash
curl -X POST http://localhost:8080/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "john.doe",
    "email": "john.doe@example.com",
    "password": "password123",
    "firstName": "John",
    "lastName": "Doe",
    "phoneNumber": "+33612345678"
  }'
```

**R√©ponse :**
```json
{
  "accessToken": "eyJhbGciOiJIUzUxMiJ9...",
  "tokenType": "Bearer",
  "expiresIn": 86400000,
  "refreshToken": "eyJhbGciOiJIUzUxMiJ9...",
  "userInfo": {
    "id": 1,
    "username": "john.doe",
    "email": "john.doe@example.com",
    "firstName": "John",
    "lastName": "Doe",
    "roles": ["ROLE_USER"]
  }
}
```

### 2. Se connecter

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "usernameOrEmail": "john.doe",
    "password": "password123"
  }'
```

### 3. Cr√©er un compte bancaire

```bash
curl -X POST http://localhost:8080/api/accounts \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {votre-token}" \
  -d '{
    "accountType": "CHECKING",
    "initialBalance": 1000.00,
    "currency": "EUR"
  }'
```

**R√©ponse :**
```json
{
  "id": 1,
  "accountNumber": "FR7612345678901234567890",
  "accountType": "CHECKING",
  "balance": 1000.00,
  "currency": "EUR",
  "status": "ACTIVE",
  "owner": {
    "id": 1,
    "username": "john.doe",
    "fullName": "John Doe",
    "email": "john.doe@example.com"
  },
  "createdAt": "2024-01-15T10:30:00"
}
```

### 4. Effectuer un d√©p√¥t

```bash
curl -X POST http://localhost:8080/api/transactions/accounts/1/deposit \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {votre-token}" \
  -d '{
    "amount": 500.00,
    "description": "D√©p√¥t de salaire"
  }'
```

### 5. Effectuer un virement

```bash
curl -X POST http://localhost:8080/api/transactions/accounts/1/transfer \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {votre-token}" \
  -d '{
    "amount": 250.00,
    "destinationAccountNumber": "FR7698765432109876543210",
    "description": "Remboursement"
  }'
```

### 6. Consulter l'historique des transactions

```bash
curl -X GET http://localhost:8080/api/transactions/history/paginated?page=0&size=10 \
  -H "Authorization: Bearer {votre-token}"
```

## üß™ Tests

### Ex√©cuter tous les tests

```bash
mvn test
```

### Ex√©cuter les tests avec couverture

```bash
mvn test jacoco:report
```

Le rapport de couverture sera g√©n√©r√© dans `target/site/jacoco/index.html`.

### Tests d'int√©gration

```bash
mvn verify
```

## üìÅ Structure du projet

```
bank-system/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ java/com/bank/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/              # Configurations (Security, OpenAPI)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controller/          # Contr√¥leurs REST
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                 # Data Transfer Objects
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exception/           # Exceptions personnalis√©es
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ model/               # Entit√©s JPA
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository/          # Repositories Spring Data
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security/            # JWT, UserDetails, Filters
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service/             # Logique m√©tier
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BankSystemApplication.java
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ resources/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ application.yml      # Configuration principale
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ logback-spring.xml   # Configuration des logs
‚îÇ   ‚îî‚îÄ‚îÄ test/
‚îÇ       ‚îî‚îÄ‚îÄ java/com/bank/           # Tests unitaires et d'int√©gration
‚îú‚îÄ‚îÄ target/                          # Fichiers compil√©s
‚îú‚îÄ‚îÄ logs/                            # Logs de l'application
‚îú‚îÄ‚îÄ .dockerignore                    # Fichiers exclus de Docker
‚îú‚îÄ‚îÄ Dockerfile                       # Image Docker de l'app
‚îú‚îÄ‚îÄ docker-compose.yml               # Orchestration des services
‚îú‚îÄ‚îÄ pom.xml                          # D√©pendances Maven
‚îî‚îÄ‚îÄ README.md                        # Documentation
```

## üê≥ Docker

### Construire l'image Docker

```bash
docker build -t bank-system:1.0.0 .
```

### Lancer l'application avec Docker

```bash
# Lancer uniquement la base de donn√©es
docker-compose up -d postgres

# Lancer l'application et la base de donn√©es
docker-compose up -d

# Voir les logs en temps r√©el
docker-compose logs -f

# Arr√™ter tous les services
docker-compose down

# Supprimer √©galement les volumes (donn√©es)
docker-compose down -v
```

### Commandes Docker utiles

```bash
# Lister les conteneurs en cours
docker ps

# Acc√©der au shell de l'application
docker exec -it bank-app sh

# Acc√©der √† PostgreSQL
docker exec -it bank-postgres psql -U bankuser -d bankdb

# Voir les logs d'un service
docker-compose logs -f bank-app

# Reconstruire l'image apr√®s modification
docker-compose up -d --build
```

---

## üóÑÔ∏è Acc√©der √† la Base de Donn√©es PostgreSQL

### **M√©thode 1 : Via pgAdmin (Interface graphique - RECOMMAND√â)**

pgAdmin est une interface graphique qui facilite la gestion de PostgreSQL. Plut√¥t que de taper des commandes SQL, vous utilisez une interface visuelle avec des clics de souris.

#### **√âtape 1 : D√©marrer pgAdmin**

```bash
docker-compose --profile admin up -d
```

**R√©sultat attendu :**
```
‚úî Container bank-pgadmin  Started
```

#### **√âtape 2 : Acc√©der √† pgAdmin**

1. **Ouvrez votre navigateur** : http://localhost:5050
2. **Connectez-vous avec** :
   - **Email** : `admin@banksystem.com`
   - **Mot de passe** : `admin123`

#### **√âtape 3 : Ajouter le serveur PostgreSQL**

Une fois connect√©, vous devez enregistrer votre serveur PostgreSQL :

1. **Clic droit** sur **"Servers"** dans le menu de gauche
2. S√©lectionnez **"Register"** ‚Üí **"Server..."**

**Configuration du serveur :**

**Onglet "General"** :
- **Name** : `Bank System DB` (vous pouvez choisir n'importe quel nom)

**Onglet "Connection"** :
| Champ | Valeur | Note |
|-------|--------|------|
| **Host name/address** | `postgres` | ‚ö†Ô∏è Important : utilisez `postgres` (nom du conteneur), pas `localhost` |
| **Port** | `5432` | Port par d√©faut PostgreSQL |
| **Maintenance database** | `bankdb` | Nom de votre base de donn√©es |
| **Username** | `bankuser` | Utilisateur de la base |
| **Password** | `bankpass` | Mot de passe |
| **Save password?** | ‚úÖ Cochez | Pour ne pas retaper √† chaque fois |

3. **Cliquez sur "Save"**

‚úÖ Vous devriez maintenant voir votre serveur dans la liste !

#### **√âtape 4 : Explorer vos donn√©es**

Dans le menu de gauche, d√©pliez l'arborescence (cliquez sur les fl√®ches ‚ñ∂) :

```
üìÅ Servers (1)
   ‚îî‚îÄ üìä Bank System DB
       ‚îî‚îÄ üìÅ Databases (1)
           ‚îî‚îÄ üìä bankdb
               ‚îî‚îÄ üìÅ Schemas (1)
                   ‚îî‚îÄ üìÅ public
                       ‚îî‚îÄ üìÅ Tables (5)
                           ‚îú‚îÄ üìã accounts        ‚Üê Comptes bancaires
                           ‚îú‚îÄ üìã transactions    ‚Üê Transactions
                           ‚îú‚îÄ üìã users           ‚Üê Utilisateurs
                           ‚îî‚îÄ üìã user_roles      ‚Üê R√¥les
```

#### **√âtape 5 : Visualiser vos donn√©es**

Pour voir les donn√©es d'une table :

1. **Naviguez** vers : `Tables` dans l'arborescence
2. **Clic droit** sur une table (ex: `users`)
3. Choisissez **"View/Edit Data"** ‚Üí **"All Rows"**

üéâ Vous voyez maintenant toutes vos donn√©es !

#### **Actions utiles dans pgAdmin**

**üìä Ex√©cuter une requ√™te SQL personnalis√©e :**
1. Clic droit sur **`bankdb`**
2. Choisissez **"Query Tool"**
3. Tapez votre requ√™te SQL :

```sql
-- Voir tous vos comptes avec les soldes
SELECT 
    u.username,
    a.account_number,
    a.account_type,
    a.balance,
    a.currency,
    a.status
FROM users u
JOIN accounts a ON u.id = a.user_id
ORDER BY a.created_at DESC;
```

4. Cliquez sur ‚ñ∂Ô∏è **Execute** (ou appuyez sur F5)

**‚úèÔ∏è Modifier une donn√©e :**
1. Ouvrez une table en mode "View/Edit Data"
2. Double-cliquez sur une cellule
3. Modifiez la valeur
4. Cliquez sur la **disquette** üíæ en haut pour sauvegarder

#### **Requ√™tes SQL utiles**

**Voir toutes les transactions :**
```sql
SELECT 
    t.id,
    t.transaction_type,
    t.amount,
    t.description,
    t.status,
    t.transaction_date,
    sa.account_number AS from_account,
    da.account_number AS to_account
FROM transactions t
LEFT JOIN accounts sa ON t.source_account_id = sa.id
LEFT JOIN accounts da ON t.destination_account_id = da.id
ORDER BY t.transaction_date DESC;
```

**Statistiques par type de transaction :**
```sql
SELECT 
    transaction_type,
    COUNT(*) as nombre,
    SUM(amount) as montant_total
FROM transactions
WHERE status = 'COMPLETED'
GROUP BY transaction_type;
```

**Voir les comptes avec leur utilisateur :**
```sql
SELECT 
    u.username,
    u.email,
    a.account_number,
    a.balance,
    a.status
FROM users u
LEFT JOIN accounts a ON u.id = a.user_id;
```

#### **‚ö†Ô∏è R√©solution des probl√®mes courants**

**‚ùå Erreur "Could not connect to server"**
- V√©rifiez que PostgreSQL tourne : `docker ps | grep postgres`
- V√©rifiez que vous avez bien utilis√© `postgres` comme Host (pas `localhost`)
- Red√©marrez pgAdmin : `docker-compose restart pgadmin`

**‚ùå Erreur "password authentication failed"**
- V√©rifiez Username : `bankuser` (pas `postgres`)
- V√©rifiez Password : `bankpass`

**‚ùå La page http://localhost:5050 ne charge pas**
```bash
# V√©rifier que pgAdmin tourne
docker ps | grep pgadmin

# Voir les logs
docker logs bank-pgadmin

# Red√©marrer
docker-compose --profile admin restart
```

---

### **M√©thode 2 : Via ligne de commande (Terminal)**

Pour les utilisateurs avanc√©s qui pr√©f√®rent le terminal :

#### **Acc√©der √† PostgreSQL en ligne de commande**

```bash
docker exec -it bank-postgres psql -U bankuser -d bankdb
```

#### **Commandes SQL utiles dans psql**

```sql
-- Voir toutes les tables
\dt

-- Voir les utilisateurs
SELECT id, username, email, first_name, last_name, created_at FROM users;

-- Voir les comptes bancaires
SELECT id, account_number, account_type, balance, currency, status FROM accounts;

-- Voir les transactions
SELECT id, transaction_type, amount, description, status, transaction_date FROM transactions;

-- Voir les d√©tails d'un utilisateur avec ses comptes
SELECT u.username, a.account_number, a.balance, a.currency 
FROM users u 
LEFT JOIN accounts a ON u.id = a.user_id 
WHERE u.username = 'votre_username';

-- Quitter psql
\q
```

#### **Commandes psql utiles**

| Commande | Description |
|----------|-------------|
| `\dt` | Lister toutes les tables |
| `\d nom_table` | Voir la structure d'une table |
| `\du` | Lister les utilisateurs PostgreSQL |
| `\l` | Lister toutes les bases de donn√©es |
| `\c nom_db` | Se connecter √† une autre base |
| `\q` | Quitter psql |
| `\h` | Aide sur les commandes SQL |
| `\?` | Aide sur les commandes psql |

---

### **M√©thode 3 : SSH Tunnel + pgAdmin LOCAL (Production - RECOMMAND√â) üåü**

‚ö†Ô∏è **Important** : En production, pgAdmin n'est **JAMAIS** d√©ploy√© sur le serveur pour des raisons de s√©curit√©. Vous utilisez **pgAdmin sur VOTRE machine** en cr√©ant un tunnel s√©curis√© vers le serveur !

#### **Comment √ßa marche ?**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Votre PC   ‚îÇ  Tunnel SSH chiffr√©  ‚îÇ  Serveur    ‚îÇ
‚îÇ             ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§             ‚îÇ
‚îÇ  pgAdmin    ‚îÇ                      ‚îÇ PostgreSQL  ‚îÇ
‚îÇ  (local)    ‚îÇ                      ‚îÇ  (priv√©)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

Le tunnel SSH cr√©e une connexion s√©curis√©e et chiffr√©e entre votre machine locale et le serveur de production, vous permettant d'acc√©der √† PostgreSQL comme s'il √©tait sur votre machine.

#### **√âtapes pratiques :**

**1Ô∏è‚É£ Cr√©er le tunnel SSH** (depuis votre PC)

```bash
# Syntaxe g√©n√©rale
ssh -L local_port:remote_host:remote_port user@server

# Exemple concret pour votre application
ssh -L 5433:localhost:5432 root@votre-serveur.com

# Ou si vous utilisez une cl√© SSH
ssh -i ~/.ssh/id_rsa -L 5433:localhost:5432 root@votre-serveur.com
```

**Explication des param√®tres :**
- `5433` : Port LOCAL sur votre PC (on utilise 5433 pour √©viter les conflits avec un PostgreSQL local √©ventuel)
- `localhost:5432` : PostgreSQL sur le serveur (localhost du POINT DE VUE du serveur)
- `root@votre-serveur.com` : Votre serveur de production

‚ö†Ô∏è **IMPORTANT** : Laissez ce terminal **OUVERT** - le tunnel reste actif tant que la connexion SSH est active. Si vous fermez le terminal, le tunnel se ferme.

---

**2Ô∏è‚É£ Ouvrir pgAdmin sur VOTRE PC**

Si vous n'avez pas pgAdmin install√© localement :

```bash
# Sur Linux (Debian/Ubuntu)
sudo apt install pgadmin4

# Sur Linux (Fedora/RHEL)
sudo dnf install pgadmin4

# Sur macOS
brew install --cask pgadmin4

# Sur Windows
# T√©l√©chargez depuis https://www.pgadmin.org/download/
```

**Alternative : Utiliser la version Docker de pgAdmin en local**
```bash
docker run -d \
  --name pgadmin-local \
  -p 5050:80 \
  -e PGADMIN_DEFAULT_EMAIL=admin@local.com \
  -e PGADMIN_DEFAULT_PASSWORD=admin \
  dpage/pgadmin4

# Acc√©dez √† http://localhost:5050
```

---

**3Ô∏è‚É£ Configurer la connexion dans pgAdmin**

Dans pgAdmin sur votre machine :

1. Clic droit sur **"Servers"** ‚Üí **"Register"** ‚Üí **"Server..."**

2. **Onglet "General"** :
   - **Name** : `Bank System Production`

3. **Onglet "Connection"** :

| Champ | Valeur | Note |
|-------|--------|------|
| **Host name/address** | `localhost` ou `127.0.0.1` | Via le tunnel SSH |
| **Port** | `5433` | Le port LOCAL du tunnel |
| **Maintenance database** | `bankdb` | Nom de votre base |
| **Username** | `bankuser` | Utilisateur de production |
| **Password** | `bankpass` | Mot de passe de production |
| **Save password?** | ‚úÖ Cochez | Pour √©viter de retaper |

4. **Cliquez sur "Save"**

‚úÖ **C'est fait !** Vous voyez maintenant vos donn√©es de production en toute s√©curit√© via le tunnel chiffr√© !

#### **üí° Astuce : Script pour automatiser le tunnel**

Cr√©ez un fichier `connect-prod-db.sh` dans votre projet :

```bash
#!/bin/bash

echo "üîê Cr√©ation du tunnel SSH vers la base de production..."
echo "üìä PostgreSQL sera accessible sur localhost:5433"
echo ""
echo "‚ö†Ô∏è  Gardez ce terminal ouvert tant que vous utilisez pgAdmin"
echo "‚å®Ô∏è  Appuyez sur Ctrl+C pour fermer le tunnel"
echo ""

# Remplacez par vos vraies valeurs
SERVER_USER="root"
SERVER_HOST="votre-serveur.com"
SSH_KEY="~/.ssh/id_rsa"

ssh -i $SSH_KEY -L 5433:localhost:5432 $SERVER_USER@$SERVER_HOST

echo ""
echo "‚úÖ Tunnel ferm√© proprement"
```

Rendez-le ex√©cutable et utilisez-le :
```bash
chmod +x connect-prod-db.sh
./connect-prod-db.sh
```

#### **üîç V√©rifier que le tunnel fonctionne**

Dans un autre terminal (pendant que le tunnel est actif) :

```bash
# Test de connexion via le tunnel
psql -h localhost -p 5433 -U bankuser -d bankdb

# Si √ßa se connecte, votre tunnel fonctionne ! üéâ
```

#### **‚ö†Ô∏è Bonnes pratiques de s√©curit√©**

- ‚úÖ **N'exposez JAMAIS** PostgreSQL directement sur Internet (pas de `0.0.0.0:5432`)
- ‚úÖ **Utilisez des cl√©s SSH** plut√¥t que des mots de passe
- ‚úÖ **Fermez le tunnel** quand vous ne l'utilisez plus
- ‚úÖ **Utilisez des mots de passe forts** pour PostgreSQL
- ‚úÖ **Activez l'authentification √† deux facteurs** sur votre serveur si possible
- ‚úÖ **Loggez tous les acc√®s** √† la base de donn√©es

---

### **M√©thode 4 : Avec un client SQL (DBeaver, DataGrip, etc.)**

Vous pouvez √©galement utiliser votre client SQL pr√©f√©r√© avec le tunnel SSH :

**Pour le d√©veloppement local (sans tunnel) :**
- **Type** : PostgreSQL
- **Host** : `localhost`
- **Port** : `5432`
- **Database** : `bankdb`
- **Username** : `bankuser`
- **Password** : `bankpass`

**Pour la production (avec tunnel SSH int√©gr√©) :**

La plupart des clients SQL modernes supportent SSH nativement. Exemple avec **DBeaver** :

1. **Nouvelle connexion PostgreSQL**
2. **Onglet "Main"** :
   - Host: `localhost`
   - Port: `5432` (port sur le serveur)
   - Database: `bankdb`
   - Username: `bankuser`
   - Password: `bankpass`

3. **Onglet "SSH"** :
   - ‚úÖ Cochez **"Use SSH Tunnel"**
   - Host/IP: `votre-serveur.com`
   - Port: `22`
   - Username: `root`
   - Authentication: **Public Key** (recommand√©) ou **Password**
   - Private key: `/home/vous/.ssh/id_rsa`

4. **Test Connection** ‚Üí ‚úÖ Connected !

DBeaver cr√©era automatiquement le tunnel SSH pour vous.

---

### **üéØ R√©sum√© : Acc√®s √† la base de donn√©es**

| Environnement | M√©thode | URL/Commande | Identifiants |
|---------------|---------|--------------|--------------|
| **D√©veloppement** | pgAdmin (Web UI) | http://localhost:5050 | admin@banksystem.com / admin123 |
| **D√©veloppement** | PostgreSQL Direct | `docker exec -it bank-postgres psql -U bankuser -d bankdb` | bankuser / bankpass |
| **D√©veloppement** | Client SQL | localhost:5432 | bankuser / bankpass |
| **Production** | SSH Tunnel + pgAdmin | `ssh -L 5433:localhost:5432 user@serveur` puis localhost:5433 | bankuser / bankpass |
| **Production** | SSH + psql | `ssh user@serveur` puis `docker exec -it bank-postgres-prod psql ...` | bankuser / bankpass |
| **Production** | Client SQL + SSH | Tunnel SSH int√©gr√© dans le client | bankuser / bankpass |

**‚ö†Ô∏è Important** : En production, pgAdmin n'est **JAMAIS** expos√© sur Internet. Utilisez toujours un tunnel SSH s√©curis√©.

## üîÑ CI/CD

### GitHub Actions (exemple)

Cr√©ez `.github/workflows/ci.yml` :

```yaml
name: CI/CD Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:16-alpine
        env:
          POSTGRES_DB: bankdb
          POSTGRES_USER: bankuser
          POSTGRES_PASSWORD: bankpass
        ports:
          - 5432:5432
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up JDK 17
      uses: actions/setup-java@v3
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven
    
    - name: Build with Maven
      run: mvn clean install -DskipTests
    
    - name: Run tests
      run: mvn test
    
    - name: Build Docker image
      run: docker build -t bank-system:${{ github.sha }} .
```

## ü§ù Contribuer

Les contributions sont les bienvenues ! Voici comment contribuer :

1. **Fork** le projet
2. Cr√©ez votre branche de fonctionnalit√© (`git checkout -b feature/AmazingFeature`)
3. Committez vos changements (`git commit -m 'Add some AmazingFeature'`)
4. Pushez vers la branche (`git push origin feature/AmazingFeature`)
5. Ouvrez une **Pull Request**

### Guidelines

- Respecter les conventions de code existantes
- Ajouter des tests pour les nouvelles fonctionnalit√©s
- Mettre √† jour la documentation si n√©cessaire
- √âcrire des messages de commit clairs et descriptifs

## üìù Licence

Ce projet est sous licence Apache 2.0 - voir le fichier [LICENSE](LICENSE) pour plus de d√©tails.

## üë• Auteurs

- **Votre Nom** - *Travail initial* - [VotreGitHub](https://github.com/votre-username)

## üôè Remerciements

- Spring Boot pour le framework excellent
- PostgreSQL pour la base de donn√©es robuste
- La communaut√© open source pour les outils et biblioth√®ques

## üìû Support

Pour toute question ou probl√®me :

- üìß Email : support@banksystem.com
- üêõ Issues : [GitHub Issues](https://github.com/votre-username/bank-system/issues)
- üìñ Documentation : [Wiki](https://github.com/votre-username/bank-system/wiki)

---

‚≠ê **N'oubliez pas de donner une √©toile si ce projet vous a aid√© !** ‚≠ê